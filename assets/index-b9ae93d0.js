(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const f of o)if(f.type==="childList")for(const u of f.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const f={};return o.integrity&&(f.integrity=o.integrity),o.referrerPolicy&&(f.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?f.credentials="include":o.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(o){if(o.ep)return;o.ep=!0;const f=n(o);fetch(o.href,f)}})();const a=document.getElementById("game"),i=a.getContext("2d"),s=48;var g=[],l=[];for(let e=-2;e<20;e++){l[e]=[];for(let t=0;t<10;t++)l[e][t]=0}const O={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]]},A={I:"cyan",O:"yellow",T:"purple",S:"green",Z:"red",J:"blue",L:"orange"};let h=0,w=0,r=L(),m=null;const v=document.querySelector("h2"),p=document.querySelector("button");let y=!1;function b(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function q(){const e=["I","J","L","O","S","T","Z"];for(;e.length;){const t=b(0,e.length-1),n=e.splice(t,1)[0];g.push(n)}}function L(){g.length===0&&q();const e=g.pop(),t=O[e],n=l[0].length/2-Math.ceil(t[0].length/2);return{name:e,matrix:t,row:e==="I"?-1:-2,col:n}}function F(e){const t=e.length-1;return e.map((c,o)=>c.map((f,u)=>e[t-u][o]))}function d(e,t,n){for(let c=0;c<e.length;c++)for(let o=0;o<e[c].length;o++)if(e[c][o]&&(n+o<0||n+o>=l[0].length||t+c>=l.length||l[t+c][n+o]))return!1;return!0}function S(){for(let e=0;e<r.matrix.length;e++)for(let t=0;t<r.matrix[e].length;t++)if(r.matrix[e][t]){if(r.row+e<0)return I();l[r.row+e][r.col+t]=r.name}for(let e=l.length-1;e>=0;)if(l[e].every(t=>!!t)){for(let t=e;t>=0;t--)for(let n=0;n<l[t].length;n++)l[t][n]=l[t-1][n];h+=10,v.innerText=`Счёт: ${h}`}else e--;r=L()}function I(){cancelAnimationFrame(m),y=!0,p.style.display="block",i.fillStyle="black",i.globalAlpha=.75,i.fillRect(0,a.height/2-30,a.width,60),i.globalAlpha=1,i.fillStyle="white",i.font="36px monospace",i.textAlign="center",i.textBaseline="middle",i.fillText("Вы проиграли",a.width/2,a.height/2)}function x(){m=requestAnimationFrame(x),i.clearRect(0,0,a.width,a.height);for(let e=0;e<20;e++)for(let t=0;t<10;t++)if(l[e][t]){const n=l[e][t];i.fillStyle=A[n],i.fillRect(t*s,e*s,s-1,s-1)}if(r){++w>35&&(r.row++,w=0,d(r.matrix,r.row,r.col)||(r.row--,S())),i.fillStyle=A[r.name];for(let e=0;e<r.matrix.length;e++)for(let t=0;t<r.matrix[e].length;t++)r.matrix[e][t]&&i.fillRect((r.col+t)*s,(r.row+e)*s,s-1,s-1)}}document.addEventListener("keydown",function(e){if(!y){if(e.key==="ArrowLeft"||e.key==="ArrowRight"){const t=e.key==="ArrowLeft"?r.col-1:r.col+1;d(r.matrix,r.row,t)&&(r.col=t)}if(e.key==="ArrowUp"){const t=F(r.matrix);d(t,r.row,r.col)&&(r.matrix=t)}if(e.key==="ArrowDown"){const t=r.row+1;if(!d(r.matrix,t,r.col)){r.row=t-1,S();return}r.row=t}}});m=requestAnimationFrame(x);p.addEventListener("click",()=>{y=!1,h=0,w=0,g=[];for(let e=-2;e<20;e++)for(let t=0;t<10;t++)l[e][t]=0;v.innerText="Счет: 0",m=requestAnimationFrame(x),p.style.display="none"});
